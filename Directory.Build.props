<Project>
	<PropertyGroup>
		<OutputType>Library</OutputType>
		<TargetFramework>net462</TargetFramework>
		<LangVersion>11.0</LangVersion>
		<Nullable>enable</Nullable>
		<Deterministic>true</Deterministic>
		<AllowUnsafeBlocks>True</AllowUnsafeBlocks>
		<DebugType>portable</DebugType>
		<GenerateDocumentationFile>True</GenerateDocumentationFile>

		<CopyToLibraries Condition="'$(CopyToLibraries)'==''">true</CopyToLibraries>
        
        <RestoreAdditionalProjectSources>
            https://pkg.munally.com/MonkeyModdingTroop/index.json;
            https://pkg.munally.com/ResoniteModdingGroup/index.json
        </RestoreAdditionalProjectSources>
	</PropertyGroup>

	<PropertyGroup Condition="'$(NugetPath)'==''">
		<NugetPath Condition="'$(OS)' == 'Windows_NT'">nuget.exe</NugetPath>
		<NugetPath Condition="'$(OS)' != 'Windows_NT'">/bin/nuget</NugetPath>
		<NugetPath Condition="Exists('S:\NuGet\nuget.exe')">S:\NuGet\nuget.exe</NugetPath>
	</PropertyGroup>

	<PropertyGroup Condition="'$(ResonitePath)'==''">
		<ResonitePath>$(MSBuildThisFileDirectory)Resonite</ResonitePath>
		<ResonitePath Condition="Exists('C:\Program Files (x86)\Steam\steamapps\common\Resonite\')">C:\Program Files (x86)\Steam\steamapps\common\Resonite</ResonitePath>
		<ResonitePath Condition="Exists('$(HOME)/.steam/steam/steamapps/common/Resonite/')">$(HOME)/.steam/steam/steamapps/common/Resonite</ResonitePath>
		<ResonitePath Condition="Exists('D:/Files/Games/Resonite/app/')">D:/Files/Games/Resonite/app</ResonitePath>
	</PropertyGroup>

	<Target Name="PackNugetPkg">
		<Message Text="Packing Resonite Game Pack" Importance="high" />
		<Exec
			Condition="'$(Configuration)'!='Release'"
			Command="$(NugetPath) pack &quot;$(ProjectDir)..\$(NuPkgName).Debug.nuspec&quot; -OutputFileNamesWithoutVersion -Symbols -SymbolPackageFormat snupkg"
			ConsoleToMSBuild="true"
		>
			<Output TaskParameter="ConsoleOutput" PropertyName="OutputOfExec" />
		</Exec>
		<Exec
			Condition="'$(Configuration)'=='Release'"
			Command="$(NugetPath) pack &quot;$(ProjectDir)..\$(NuPkgName).nuspec&quot; -OutputFileNamesWithoutVersion -Symbols -SymbolPackageFormat snupkg"
			ConsoleToMSBuild="true"
		>
			<Output TaskParameter="ConsoleOutput" PropertyName="OutputOfExec" />
		</Exec>

		<Copy
			Condition="'$(CopyToLibraries)'=='true'"
			SourceFiles="$(ProjectDir)$(NuPkgName).nupkg"
			DestinationFiles="$(ResonitePath)\MonkeyLoader\Mods\$(NuPkgName).nupkg" />
		<Message
			Condition="'$(CopyToLibraries)'=='true'"
			Text="Copied '$(NuPkgName).nupkg' to '$(ResonitePath)\MonkeyLoader\Mods\$(NuPkgName).nupkg'"
			Importance="high" />
	</Target>

</Project>
